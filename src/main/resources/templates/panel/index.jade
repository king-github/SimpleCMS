extends ./panel-layout

include ./includes/mixins-panel.jade

mixin sortIndicator(sMode, mode)

  if sMode == mode || sMode+'_DESC' == mode
    if mode.isDesc()
        i.fas.fa-sort-amount-down
    else
        i.fas.fa-sort-amount-up
  block

block content

  - var params = pagerParamsHelper.getSortParamsString(articles.getPageable())
  - var sortMode = sortModeHelper.findModeByParamString(params)
  - var offset = articles.getPageable().getOffset()

  h1= title

  .btn-toolbar
    form(method="get" autocomplete="off")
     .form-group.row
      .mb-2.col-lg-3
        label(for="inputTitle") Title
        input(type="text" class="form-control" id="inputTitle" placeholder="Title" name="title" value=articleSearchForm.title)
        .invalid-feedback
           for err in errors.getMessages("title")
              span=err

      .mb-2.col-lg-3
        label(for="inputFirstname") First name
        input(type="text" class="form-control" id="inputFirstname" placeholder="First name" name="firstname" value=articleSearchForm.firstname)

      .mb-2.col-lg-3
        label(for="inputLastname") Last name
        input(type="text" class="form-control" id="inputLastname" placeholder="Last name" name="lastname" value=articleSearchForm.lastname)
        .invalid-feedback
           for err in errors.getMessages("title")
             span=err

      .mb-2.col-lg-3
        label(for="inputSection") Section
        select(id="inputSection" name="sectionId").form-control
          if articleSearchForm.sectionId
            option(value="") All
          else
            option(value="" selected) All
          for section in sections
            if section.id == articleSearchForm.sectionId
              option(value=section.id selected)= section.name
            else
              option(value=section.id)= section.name

      .mb-2.col-lg-3
        label(for="inputFrom") Date from
        input(type="text" class=errors.getValidCss("dateFrom", "form-control", "form-control is-invalid") id="inputFrom" placeholder="Date from" name="dateFrom" value=articleSearchForm.dateFrom)
        .invalid-feedback
            for err in errors.getMessages("dateFrom")
              span=err


      .mb-2.col-lg-3.form-group
        label(for="inputTo") Date to
        input(type="text" class=errors.getValidCss("dateTo", "form-control", "form-control is-invalid") id="inputTo" placeholder="Date to" name="dateTo" value=articleSearchForm.dateTo)
        .invalid-feedback
          for err in errors.getMessages("dateTo")
            span=err

      .mb-2.col-lg-3
        label(for="inputPublished") Published
        select(id="inputPublished" name="published").form-control
          if articleSearchForm.published==null
            option(value="" selected) All
          else
            option(value="") All
          if articleSearchForm.published==true
            option(value="true" selected) Only published
          else
            option(value="true") Only published
          if articleSearchForm.published==false
            option(value="false" selected) Only not published
          else
            option(value="false") Only not published

      .mb-2.col-lg-3
        label(for="inputSubmit") Reload table
        button(type="submit" id="inputSubmit").btn.btn-secondary.btn-block Filter

  table.table.table-striped
    tr
      th #
      th id
      th: +sortIndicator('TITLE', sortMode)  title
      th: +sortIndicator('AUTHOR', sortMode)  author
      th: +sortIndicator('SECTION', sortMode)  section
      th: +sortIndicator('DATE', sortMode)  publication date
      th published

    for article, i in articles
      tr
        td= i +offset +1
        td= article.id
        td= article.title
        td= article.author.firstname +' '+ article.author.lastname
        td= article.section.name
        td= article.publicationDate.format(dtFormatter)

        if article.published
           td published
        else
           td not published

  .btn-toolbar
      +pageSizeBox(articles, ' articles per page')
      +sortBox(articles)
      .btn-group.mr-2
        +pagerBox(articles)


  .info= info